"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function lerp(e,t,i){return t*(1-e)+i*e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Bezier=function(){function e(t,i,r,a){_classCallCheck(this,e),this.x0=void 0!==t?t:.25,this.y0=void 0!==i?i:.25,this.x1=void 0!==r?r:.75,this.y1=void 0!==a?a:.75}return _createClass(e,[{key:"set",value:function(e,t,i,r){void 0!==e&&(this.x0=e),void 0!==t&&(this.y0=t),void 0!==i&&(this.x1=i),void 0!==r&&(this.y1=r)}},{key:"at",value:function(t){return e.curveAt(t,this.x0,this.y0,this.x1,this.y1)}},{key:"isLinear",value:function(){return e.isLinear(this.x0,this.y0,this.x1,this.y1)}}],[{key:"isLinear",value:function(){return this.x0===1-this.x1&&this.y0===1-this.y1}},{key:"curveAt",value:function(t,i,r,a,n){if(t<=0)return 0;if(t>=1)return 1;if(e.isLinear(i,r,a,n))return t;var s=0,o=0,u=i,l=r,c=a,f=n,h=1,p=1,d=h-3*c+3*u-s,y=3*c-6*u+3*s,m=3*u-3*s,_=s,v=p-3*f+3*l-o,b=3*f-6*l+3*o,k=3*l-3*o,C=o,w=t,g=void 0,O=void 0,P=void 0;for(g=0;g<5;g++)O=e.xFromT(w,d,y,m,_),P=e.slopeFromT(w,d,y,m),w-=(O-t)*P,w=Math.min(Math.max(w,0),1);return e.yFromT(w,v,b,k,C)}},{key:"slopeFromT",value:function(e,t,i,r){return 1/(3*t*e*e+2*i*e+r)}},{key:"xFromT",value:function(e,t,i,r,a){return t*(e*e*e)+i*(e*e)+r*e+a}},{key:"yFromT",value:function(e,t,i,r,a){var n=e*e;return t*(n*e)+i*n+r*e+a}},{key:"getEase",value:function(t){var i=void 0;switch(t){case"linear":i=new e;break;case"inQuad":i=new e(.55,.085,.68,.53);break;case"inCubic":i=new e(.55,.055,.675,.19);break;case"inQuart":i=new e(.895,.03,.685,.22);break;case"inQuint":i=new e(.755,.05,.855,.06);break;case"inSine":i=new e(.47,0,.745,.715);break;case"inExpo":i=new e(.95,.05,.795,.035);break;case"inCirc":i=new e(.6,.04,.98,.335);break;case"inBack":i=new e(.6,0,.735,.045);break;case"outQuad":i=new e(.25,.46,.45,.94);break;case"outCubic":i=new e(.215,.61,.355,1);break;case"outQuart":i=new e(.165,.84,.44,1);break;case"outQuint":i=new e(.23,1,.32,1);break;case"outSine":i=new e(.39,.575,.565,1);break;case"outExpo":i=new e(.19,1,.22,1);break;case"outCirc":i=new e(.075,.82,.165,1);break;case"outBack":i=new e(.175,.885,.32,1);break;case"inOutQuad":i=new e(.455,.03,.515,.955);break;case"inOutCubic":i=new e(.645,.045,.355,1);break;case"inOutQuart":i=new e(.77,0,.175,1);break;case"inOutQuint":i=new e(.86,0,.07,1);break;case"inOutSine":i=new e(.445,.05,.55,.95);break;case"inOutExpo":i=new e(1,0,0,1);break;case"inOutCirc":i=new e(.785,.135,.15,.86);break;case"inOutBack":i=new e(.68,0,.265,1)}return i}}]),e}();exports["default"]=Bezier,Object.defineProperty(exports,"__esModule",{value:!0});var Marker=function e(t,i,r,a,n){_classCallCheck(this,e),this.name=void 0!==t?t:"",this.time=void 0!==i?i:0,this.action=void 0!==r?r:"",this.duration=void 0!==a?a:0,this.trigger=void 0!==n?n:function(){}};exports["default"]=Marker,Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),TIME=performance||Date,Timer=function(){function e(t){_classCallCheck(this,e),this.running=!1,this.time=1,this.timeStamp=0,this.deltaStamp=0,this.elapsedStamp=0,this.delayed=[],this.onRAF=void 0,this.onUpdate=this.update.bind(this),this.updateHandler=t}return _createClass(e,[{key:"play",value:function(){this.timeStamp=TIME.now(),this.running=!0,this.update()}},{key:"pause",value:function(){window.cancelAnimationFrame(this.onRAF),this.running=!1}},{key:"restart",value:function(){this.deltaStamp=this.elapsedStamp=0,this.stamp()}},{key:"stamp",value:function(){this.timeStamp=TIME.now()}},{key:"update",value:function(){var e=TIME.now();this.deltaStamp=e-this.timeStamp,this.elapsedStamp+=this.deltaStamp*this.time,this.timeStamp=e;var t=void 0,i=void 0,r=this.delayed.length;for(t=0;t<r;++t)i=this.delayed[t],e>=i.time&&(i.callback(i.params),this.delayed.splice(t,1),--t,--r);this.updateHandler(),this.onRAF=window.requestAnimationFrame(this.onUpdate)}},{key:"delay",value:function(e,t,i){this.delayed.push({time:1e3*e+TIME.now(),callback:t,params:i})}},{key:"seconds",get:function(){return this.elapsedStamp/1e3},set:function(e){this.elapsedStamp=1e3*e}}]),e}();exports["default"]=Timer,Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),_Bezier=require("./Bezier"),_Bezier2=_interopRequireDefault(_Bezier),KeyframeType={LINEAR:"linear",BEZIER:"bezier",HOLD:"hold"},Keyframe=function(){function e(t,i,r,a,n,s,o,u,l){_classCallCheck(this,e),this.active=!1,this.ease=void 0!==s?s:[.25,.25,.75,.75],this.timestamp=void 0!==n?n:0,this.duration=a,this.object=t,this.key=i,this.startValue=o,this.endValue=r,this.onComplete=u,this.onUpdate=l,this.ease[0]===this.ease[1]&&this.ease[2]===this.ease[3]?this.easeType=KeyframeType.LINEAR:this.easeType=KeyframeType.BEZIER}return _createClass(e,[{key:"update",value:function(e){var t=e;this.easeType===KeyframeType.BEZIER?t=_Bezier2["default"].curveAt(t,this.ease[0],this.ease[1],this.ease[2],this.ease[3]):this.easeType===KeyframeType.HOLD&&(t=e<1?0:1),this.object[this.key]=lerp(t,this.startValue,this.endValue),void 0!==this.onUpdate&&this.onUpdate(e,t)}},{key:"restart",value:function(){this.object[this.key]=this.startValue}},{key:"finish",value:function(){this.update(1)}},{key:"complete",value:function(){this.finish(),void 0!==this.onComplete&&this.onComplete(),this.active=!1}},{key:"isActive",value:function(e){return e>=this.startTime&&e<=this.endTime}},{key:"startTime",get:function(){return this.timestamp}},{key:"endTime",get:function(){return this.timestamp+this.duration}}]),e}();exports["default"]=Keyframe,Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Layer=function(){function e(t){_classCallCheck(this,e),this.name=void 0!==t.name?t.name:"",this.start=void 0!==t.start?t.start:0,this.duration=void 0!==t.duration?t.duration:0,this.fileID="",this.file=void 0,this.item=void 0,this.showing=void 0===t.showing||t.showing}return _createClass(e,[{key:"update",value:function(e){void 0!==this.item&&void 0!==this.item.update&&this.item.update(e)}},{key:"draw",value:function(){void 0!==this.item&&void 0!==this.item.draw&&this.item.draw()}},{key:"animate",value:function(e,t){void 0!==this.item&&void 0!==this.item.animate&&this.item.animate(e,t)}},{key:"transform",value:function(e,t){void 0!==this.item&&void 0!==this.item.transform&&this.item.transform(e,t)}},{key:"showable",value:function(e){var t=this.start+this.duration;return!(this.duration>0)||e>=this.start&&e<=t}}]),e}();exports["default"]=Layer,Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayerAudio=void 0;var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),_Config=require("./Config"),_Config2=_interopRequireDefault(_Config),_Layer2=require("./Layer"),_Layer3=_interopRequireDefault(_Layer2),LayerAudio=exports.LayerAudio=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.timestamp=0,void 0!==e.content&&(i.fileID=_Config2["default"].fileID(e.content.source),i.file=_Config2["default"].audio[i.fileID]),i}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e){var t=Date.now(),i=(t-this.timestamp)/1e3;i>1&&this.file.play(),this.timestamp=t}}]),t}(_Layer3["default"]);Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayerImage=void 0;var _Config=require("./Config"),_Config2=_interopRequireDefault(_Config),_Layer2=require("./Layer"),_Layer3=_interopRequireDefault(_Layer2),LayerImage=exports.LayerImage=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return void 0!==e.content&&(i.fileID=_Config2["default"].fileID(e.content.source),i.file=_Config2["default"].images[i.fileID]),i}return _inherits(t,e),t}(_Layer3["default"]);Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayerShape=exports.Shape=void 0;var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),_Layer2=require("./Layer"),_Layer3=_interopRequireDefault(_Layer2),Shape=exports.Shape=function(){function e(){_classCallCheck(this,e),this.fill={color:16777215,enable:!0},this.stroke={color:16777215,enable:!0,thickness:1},this.vertices=[]}return _createClass(e,[{key:"update",value:function(){}},{key:"draw",value:function(){}}]),e}(),LayerShape=exports.LayerShape=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.item=new Shape,i}return _inherits(t,e),t}(_Layer3["default"]);Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayerText=void 0;var _Layer2=require("./Layer"),_Layer3=_interopRequireDefault(_Layer2),LayerText=exports.LayerText=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,e),t}(_Layer3["default"]);Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayerVideo=void 0;var _Config=require("./Config"),_Config2=_interopRequireDefault(_Config),_Layer2=require("./Layer"),_Layer3=_interopRequireDefault(_Layer2),LayerVideo=exports.LayerVideo=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.timeStamp=0,void 0!==e.content&&(i.fileID=_Config2["default"].fileID(e.content.source),i.file=_Config2["default"].video[i.fileID]),i}return _inherits(t,e),t}(_Layer3["default"]);Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),_Timer=require("./Timer"),_Timer2=_interopRequireDefault(_Timer),PlayMode={LOOP:"loop",ONCE:"once",PING_PONG:"pingPong"},TIME=performance||Date,Timeline=function(){function e(){_classCallCheck(this,e),this.duration=0,this.timesPlayed=0,this.maxPlays=0,this.mode=PlayMode.LOOP,this.keyframes=[],this.markers=[],this.playing=!0,this.lastMarker=void 0,this.time={elapsed:0,stamp:0,speed:1}}return _createClass(e,[{key:"add",value:function(e,t,i,r,a,n,s,o,u,l,c,f){var h=0===this.duration?this.seconds+a:a,p=[n,s,o,u],d=new Keyframe(e,t,i,r,h,p,l,c,f);return this.addKeyframe(d)}},{key:"addKeyframe",value:function(e){return this.keyframes.push(e),e}},{key:"addMarker",value:function(e){return this.markers.push(e),this}},{key:"play",value:function(){if(0===this.time.elapsed)for(var e=this.keyframes.length-1,t=e;t>-1;--t)this.keyframes[t].update(0),this.keyframes[t].active=!1;this.playing=!0}},{key:"pause",value:function(){this.playing=!1}},{key:"update",value:function(){if(this.playing){var e=TIME.now(),t=e-this.time.stamp;this.time.elapsed+=t*this.time.speed,this.time.stamp=e,this.duration>0&&this.updatePlaymode(),this.updateMarkers(),this.updateKeyframes()}}},{key:"updateKeyframes",value:function(){var e,t,i,r,a=this.keyframes.length,n=this.seconds;for(e=0;e<a;++e)i=this.keyframes[e],t=n,r=(t-i.timestamp)/i.duration,i.isActive(t)?(!i.active&&void 0===i.startValue&&this.time.speed>0&&(i.startValue=i.object[i.key]),i.active=!0,i.update(r)):i.active?(i.active=!1,this.time.speed<0?i.restart():i.complete()):(i.active=!1,0===this.duration&&t-i.timestamp>1&&(this.keyframes.splice(e,1),--e,--a))}},{key:"updateMarkers",value:function(){var e=this.prevSeconds,t=this.seconds;if(e>t)return-1;for(var i=Math.min(e,t),r=Math.max(e,t),a=this.markers.length,n=0;n<a;++n){var s=this.markers[n].time;if(s>i&&s<=r&&this.markers[n]!==this.lastMarker)return this.trigger(n),this.lastMarker=this.markers[n],n}return this.lastMarker=void 0,-1}},{key:"updatePlaymode",value:function(){var e=this.seconds;if(this.mode===PlayMode.PING_PONG)e>=this.duration?(this.time.elapsed=1e3*this.duration-1,this.time.speed*=-1):e<0&&(this.time.elapsed=1,this.time.speed=Math.abs(this.time.speed),++this.timesPlayed,this.maxPlays>0&&this.timesPlayed>=this.maxPlays&&this.pause());else if(this.mode===PlayMode.LOOP){if(e>this.duration)if(++this.timesPlayed,this.maxPlays>0&&this.timesPlayed>=this.maxPlays)this.pause(),this.time.elapsed=0;else{this.time.elapsed=0;for(var t=this.keyframes.length-1,i=t;i>-1;--i)this.keyframes[i].update(0),this.keyframes[i].active=!1}}else e>this.duration&&(++this.timesPlayed,this.pause(),this.time.elapsed=0)}},{key:"trigger",value:function(e){var t=this.markers[e];return void 0!==t&&("stop"===t.action?(this.pause(),this.seconds=t.time):"delay"===t.action&&t.trigger(),!0)}},{key:"playMode",get:function(){return this.mode},set:function(e){this.mode=e,e!==PlayMode.LOOP&&e!==PlayMode.ONCE||(this.time.speed=Math.abs(this.time.speed))}},{key:"seconds",get:function(){return this.time.elapsed/1e3},set:function(e){this.time.elapsed=1e3*e}},{key:"speed",get:function(){return this.time.speed},set:function(e){this.time.speed=e}},{key:"restartable",get:function(){return!!this.playing&&(!(this.maxPlays>0&&this.timesPlayed>=this.maxPlays)&&!(this.mode===PlayMode.LOOP&&this.timesPlayed>0))}}]),e}();exports["default"]=Timeline;
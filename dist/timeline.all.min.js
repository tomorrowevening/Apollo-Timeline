"use strict";function isLinear(e,t,r,i){return e===t&&r===i}function curveAt(e,t,r,i,a){if(e<=0)return 0;if(e>=1)return 1;if(isLinear(t,r,i,a))return e;var n=0,o=0,s=t,l=r,u=i,h=a,f=1,c=1,d=f-3*u+3*s-n,p=3*u-6*s+3*n,m=3*s-3*n,v=n,y=c-3*h+3*l-o,g=3*h-6*l+3*o,_=3*l-3*o,b=o,w=e,k=void 0,C=void 0,x=void 0;for(k=0;k<5;k++)C=xFromT(w,d,p,m,v),x=slopeFromT(w,d,p,m),w-=(C-e)*x,w=Math.min(Math.max(w,0),1);return yFromT(w,y,g,_,b)}function slopeFromT(e,t,r,i){return 1/(3*t*e*e+2*r*e+i)}function xFromT(e,t,r,i,a){return t*(e*e*e)+r*(e*e)+i*e+a}function yFromT(e,t,r,i,a){var n=e*e;return t*(n*e)+r*n+i*e+a}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function styleOptions(e,t,r){var i={fill:"none",fillAlpha:1,stroke:void 0,strokeAlpha:1,strokeCap:"butt",strokeCorner:"miter",strokeDashes:void 0,strokeWidth:void 0,transform:void 0,timeline:[]},a=void 0,n=t.length;for(a=0;a<n;++a){var o=t[a];if("fill"===o.type){var s=Math.round(255*o.value.color[0]).toString(),l=Math.round(255*o.value.color[1]).toString(),u=Math.round(255*o.value.color[2]).toString(),h=o.value.opacity;i.fill="rgb("+s+", "+l+", "+u+")",i.fillAlpha=h,o.timeline.length>0&&(i.timeline=i.timeline.concat(o.timeline))}else if("stroke"===o.type){var f=Math.round(255*o.value.color[0]).toString(),c=Math.round(255*o.value.color[1]).toString(),d=Math.round(255*o.value.color[2]).toString();i.stroke="rgb("+f+", "+c+", "+d+")",i.strokeAlpha=o.value.opacity,i.strokeCap=o.value.cap,i.strokeCorner=o.value.corner,i.strokeDashes=o.value.dashes,i.strokeWidth=o.value.width,o.timeline.length>0&&(i.timeline=i.timeline.concat(o.timeline))}else if("transform"===o.type)i.transform=o;else if("trim"===o.type)for(var p=e.children.length,m=0;m<p;++m){var v=e.children[m];"path"===v.tagName&&applyTrimPath(v,o,r)}}return i}function applyTrimPath(e,t,r){e._startPercent=t.value.start,e._endPercent=t.value.end,e._offsetPercent=t.value.offset,e.updatePath();var i={start:"startPercent",end:"endPercent",offset:"offsetPercent"},a=void 0,n=t.timeline.length-1;for(a=n;a>-1;--a){var o=t.timeline[a],s=i[o.name];if(void 0!==s){var l=void 0,u=o.keys.length;for(l=0;l<u;++l){var h=o.keys[l],f=h.value,c=h.target,d=h.start,p=h.duration,m=h.x0,v=h.y0,y=h.x1,g=h.y1,_=[m,v,y,g],b=new _Keyframe2["default"](e,s,c,p,d,_,f);b.easeType=h.type,r.addKeyframe(b)}}}}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function organizeList(e){var t=["stroke","fill","transform","trim","repeater"],r=void 0,i=void 0,a=t.length,n=e.length,o=[];for(r=0;r<a;++r){var s=t[r];for(i=0;i<n;++i){var l=e[i].type;if(s===l){o.push(e[i]);break}}}return o}function createPath(e,t){var r=t?window.devicePixelRatio:1,i=[],a=void 0,n=e.vertices.length;for(a=0;a<n;++a)i.push([e.vertices[a].x*r,e.vertices[a].y*r]);return i}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function getHex(e,t,r){return 255*e<<16^255*t<<8^255*r<<0}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isLinear=isLinear,exports.curveAt=curveAt,exports.slopeFromT=slopeFromT,exports.xFromT=xFromT,exports.yFromT=yFromT;var Ease=exports.Ease={linear:[.25,.25,.75,.75],inQuad:[.55,.085,.68,.53],inCubic:[.55,.055,.675,.19],inQuart:[.895,.03,.685,.22],inQuint:[.755,.05,.855,.06],inSine:[.47,0,.745,.715],inExpo:[.95,.05,.795,.035],inCirc:[.6,.04,.98,.335],inBack:[.6,0,.735,.045],outQuad:[.25,.46,.45,.94],outCubic:[.215,.61,.355,1],outQuart:[.165,.84,.44,1],outQuint:[.23,1,.32,1],outSine:[.39,.575,.565,1],outExpo:[.19,1,.22,1],outCirc:[.075,.82,.165,1],outBack:[.175,.885,.32,1],inOutQuad:[.455,.03,.515,.955],inOutCubic:[.645,.045,.355,1],inOutQuart:[.77,0,.175,1],inOutQuint:[.86,0,.07,1],inOutSine:[.445,.05,.55,.95],inOutExpo:[1,0,0,1],inOutCirc:[.785,.135,.15,.86],inOutBack:[.68,0,.265,1]};Object.defineProperty(exports,"__esModule",{value:!0});var Marker=function e(t,r,i,a,n){_classCallCheck(this,e),this.name=void 0!==t?t:"",this.time=void 0!==r?r:0,this.action=void 0!==i?i:"",this.duration=void 0!==a?a:0,this.trigger=void 0!==n?n:function(){}};exports["default"]=Marker,Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),TIME=exports.TIME=performance||Date,Timer=exports.Timer=function(){function e(t){_classCallCheck(this,e),this.running=!1,this.time=1,this.timeStamp=0,this.deltaStamp=0,this.elapsedStamp=0,this.delayed=[],this.onRAF=void 0,this.onUpdate=this.update.bind(this),this.updateHandler=t}return _createClass(e,[{key:"play",value:function(){this.timeStamp=TIME.now(),this.running=!0,this.update()}},{key:"pause",value:function(){window.cancelAnimationFrame(this.onRAF),this.running=!1}},{key:"restart",value:function(){this.deltaStamp=this.elapsedStamp=0,this.stamp()}},{key:"stamp",value:function(){this.timeStamp=TIME.now()}},{key:"update",value:function(){var e=TIME.now();this.deltaStamp=e-this.timeStamp,this.elapsedStamp+=this.deltaStamp*this.time,this.timeStamp=e;var t=void 0,r=void 0,i=this.delayed.length;for(t=0;t<i;++t)r=this.delayed[t],e>=r.time&&(r.callback(r.params),this.delayed.splice(t,1),--t,--i);this.updateHandler(),this.onRAF=window.requestAnimationFrame(this.onUpdate)}},{key:"delay",value:function(e,t,r){this.delayed.push({time:1e3*e+TIME.now(),callback:t,params:r})}},{key:"seconds",get:function(){return this.elapsedStamp/1e3},set:function(e){this.elapsedStamp=1e3*e}}]),e}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Keyframe=exports.KeyframeType=void 0;var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_Bezier=require("./Bezier"),_MathUtil=require("apollo-utils/MathUtil"),_MathUtil2=_interopRequireDefault(_MathUtil),KeyframeType=exports.KeyframeType={LINEAR:"linear",BEZIER:"bezier",HOLD:"hold"},Keyframe=exports.Keyframe=function(){function e(t,r,i,a,n){_classCallCheck(this,e),n=void 0!==n?n:{},this.active=!1,this.object=t,this.key=r,this.endValue=i,this.duration=a,this.timestamp=void 0!==n.delay?n.delay:0,this.ease=void 0!==n.ease?n.ease:[.25,.25,.75,.75],this.startValue=n.start,this.onComplete=n.onComplete,this.onUpdate=n.onUpdate,this.easeType=KeyframeType.BEZIER,this.ease[0]===this.ease[1]&&this.ease[2]===this.ease[3]&&(this.easeType=KeyframeType.LINEAR)}return _createClass(e,[{key:"update",value:function(e){var t=e;this.easeType===KeyframeType.BEZIER?t=(0,_Bezier.curveAt)(t,this.ease[0],this.ease[1],this.ease[2],this.ease[3]):this.easeType===KeyframeType.HOLD&&(t=e<1?0:1),this.active||void 0!==this.startValue||(this.startValue=this.object[this.key]),this.object[this.key]=_MathUtil2["default"].lerp(t,this.startValue,this.endValue),void 0!==this.onUpdate&&this.onUpdate(e,t)}},{key:"complete",value:function(){this.update(1),void 0!==this.onComplete&&this.onComplete(),this.active=!1}},{key:"isActive",value:function(e){return e>=this.startTime&&e<=this.endTime}},{key:"startTime",get:function(){return this.timestamp}},{key:"endTime",get:function(){return this.timestamp+this.duration}}]),e}();Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Layer=function(){function e(t){_classCallCheck(this,e),this.name=void 0!==t.name?t.name:"",this.start=void 0!==t.start?t.start:0,this.duration=void 0!==t.duration?t.duration:0,this.fileID="",this.file=void 0,this.item=void 0,this.showing=void 0===t.showing||t.showing}return _createClass(e,[{key:"update",value:function(e){void 0!==this.item&&void 0!==this.item.update&&this.item.update(e)}},{key:"draw",value:function(){void 0!==this.item&&void 0!==this.item.draw&&this.item.draw()}},{key:"animate",value:function(e,t){void 0!==this.item&&void 0!==this.item.animate&&this.item.animate(e,t)}},{key:"transform",value:function(e,t){void 0!==this.item&&void 0!==this.item.transform&&this.item.transform(e,t)}},{key:"showable",value:function(e){var t=this.start+this.duration;return!(this.duration>0)||e>=this.start&&e<=t}}]),e}();exports["default"]=Layer,Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayerAudio=void 0;var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_Config=require("./Config"),_Config2=_interopRequireDefault(_Config),_Layer2=require("./Layer"),_Layer3=_interopRequireDefault(_Layer2),LayerAudio=exports.LayerAudio=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.timestamp=0,void 0!==e.content&&(r.fileID=_Config2["default"].fileID(e.content.source),r.file=_Config2["default"].audio[r.fileID]),r}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e){var t=Date.now(),r=(t-this.timestamp)/1e3;r>1&&this.file.play(),this.timestamp=t}}]),t}(_Layer3["default"]);Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayerImage=void 0;var _Config=require("./Config"),_Config2=_interopRequireDefault(_Config),_Layer2=require("./Layer"),_Layer3=_interopRequireDefault(_Layer2),LayerImage=exports.LayerImage=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return void 0!==e.content&&(r.fileID=_Config2["default"].fileID(e.content.source),r.file=_Config2["default"].images[r.fileID]),r}return _inherits(t,e),t}(_Layer3["default"]);Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayerShape=exports.Shape=void 0;var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_Layer2=require("./Layer"),_Layer3=_interopRequireDefault(_Layer2),Shape=exports.Shape=function(){function e(){_classCallCheck(this,e),this.fill={color:16777215,enable:!0},this.stroke={color:16777215,enable:!0,thickness:1},this.vertices=[]}return _createClass(e,[{key:"update",value:function(){}},{key:"draw",value:function(){}}]),e}(),LayerShape=exports.LayerShape=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.item=new Shape,r}return _inherits(t,e),t}(_Layer3["default"]);Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayerText=void 0;var _Layer2=require("./Layer"),_Layer3=_interopRequireDefault(_Layer2),LayerText=exports.LayerText=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,e),t}(_Layer3["default"]);Object.defineProperty(exports,"__esModule",{value:!0}),exports.LayerVideo=void 0;var _Config=require("./Config"),_Config2=_interopRequireDefault(_Config),_Layer2=require("./Layer"),_Layer3=_interopRequireDefault(_Layer2),LayerVideo=exports.LayerVideo=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.timeStamp=0,void 0!==e.content&&(r.fileID=_Config2["default"].fileID(e.content.source),r.file=_Config2["default"].video[r.fileID]),r}return _inherits(t,e),t}(_Layer3["default"]);Object.defineProperty(exports,"__esModule",{value:!0}),exports.Timeline=exports.PlayMode=void 0;var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_Timer=require("./Timer"),PlayMode=exports.PlayMode={LOOP:"loop",ONCE:"once",PING_PONG:"pingPong"},Timeline=exports.Timeline=function(){function e(){_classCallCheck(this,e),this.duration=0,this.timesPlayed=0,this.maxPlays=0,this.mode=PlayMode.LOOP,this.keyframes=[],this.markers=[],this.playing=!0,this.lastMarker=void 0,this.time={elapsed:0,stamp:0,speed:1}}return _createClass(e,[{key:"add",value:function(e,t,r,i,a,n,o,s,l,u,h,f){var c=0===this.duration?this.seconds+a:a,d=[n,o,s,l],p=new Keyframe(e,t,r,i,c,d,u,h,f);return this.addKeyframe(p)}},{key:"addKeyframe",value:function(e){return this.keyframes.push(e),e}},{key:"addMarker",value:function(e){return this.markers.push(e),this}},{key:"play",value:function(){if(0===this.time.elapsed)for(var e=this.keyframes.length-1,t=e;t>-1;--t)this.keyframes[t].update(0),this.keyframes[t].active=!1;this.playing=!0}},{key:"pause",value:function(){this.playing=!1}},{key:"update",value:function(){if(this.playing){var e=_Timer.TIME.now(),t=e-this.time.stamp;this.time.elapsed+=t*this.time.speed,this.time.stamp=e,this.duration>0&&this.updatePlaymode(),this.updateMarkers(),this.updateKeyframes()}}},{key:"updateKeyframes",value:function(){var e,t,r,i,a=this.keyframes.length,n=this.seconds;for(e=0;e<a;++e)r=this.keyframes[e],t=n,i=(t-r.timestamp)/r.duration,r.isActive(t)?(!r.active&&void 0===r.startValue&&this.time.speed>0&&(r.startValue=r.object[r.key]),r.active=!0,r.update(i)):r.active?(r.active=!1,this.time.speed<0?r.restart():r.complete()):(r.active=!1,0===this.duration&&t-r.timestamp>1&&(this.keyframes.splice(e,1),--e,--a))}},{key:"updateMarkers",value:function(){var e=this.prevSeconds,t=this.seconds;if(e>t)return-1;for(var r=Math.min(e,t),i=Math.max(e,t),a=this.markers.length,n=0;n<a;++n){var o=this.markers[n].time;if(o>r&&o<=i&&this.markers[n]!==this.lastMarker)return this.trigger(n),this.lastMarker=this.markers[n],n}return this.lastMarker=void 0,-1}},{key:"updatePlaymode",value:function(){var e=this.seconds;if(this.mode===PlayMode.PING_PONG)e>=this.duration?(this.time.elapsed=1e3*this.duration-1,this.time.speed*=-1):e<0&&(this.time.elapsed=1,this.time.speed=Math.abs(this.time.speed),++this.timesPlayed,this.maxPlays>0&&this.timesPlayed>=this.maxPlays&&this.pause());else if(this.mode===PlayMode.LOOP){if(e>this.duration)if(++this.timesPlayed,this.maxPlays>0&&this.timesPlayed>=this.maxPlays)this.pause(),this.time.elapsed=0;else{this.time.elapsed=0;for(var t=this.keyframes.length-1,r=t;r>-1;--r)this.keyframes[r].update(0),this.keyframes[r].active=!1}}else e>this.duration&&(++this.timesPlayed,this.pause(),this.time.elapsed=0)}},{key:"trigger",value:function(e){var t=this.markers[e];return void 0!==t&&("stop"===t.action?(this.pause(),this.seconds=t.time):"delay"===t.action&&t.trigger(),!0)}},{key:"playMode",get:function(){return this.mode},set:function(e){this.mode=e,e!==PlayMode.LOOP&&e!==PlayMode.ONCE||(this.time.speed=Math.abs(this.time.speed))}},{key:"seconds",get:function(){return this.time.elapsed/1e3},set:function(e){this.time.elapsed=1e3*e}},{key:"speed",get:function(){return this.time.speed},set:function(e){this.time.speed=e}},{key:"restartable",get:function(){return!!this.playing&&(!(this.maxPlays>0&&this.timesPlayed>=this.maxPlays)&&!(this.mode===PlayMode.LOOP&&this.timesPlayed>0))}}]),e}();Object.defineProperty(exports,"__esModule",{value:!0});var _DOMUtil=require("apollo-utils/DOMUtil"),_DOMUtil2=_interopRequireDefault(_DOMUtil),_MathUtil=require("apollo-utils/MathUtil"),_MathUtil2=_interopRequireDefault(_MathUtil),_Keyframe=require("../timeline/Keyframe"),_Keyframe2=_interopRequireDefault(_Keyframe),SVG={animate:function(e,t,r){var i,a,n,o=t.length;for(i=0;i<o;++i){var s=t[i];for(n=s.keys.length,a=0;a<n;++a){var l=s.keys[a],u=[l.value],h=l.target,f=l.start,c=l.duration,d=l.x0,p=l.y0,m=l.x1,v=l.y1,y=[d,p,m,v],g=void 0;switch(s.name){case"dash":g=new _Keyframe2["default"](e,"strokeDash",h,c,f,y,u,(void 0),(void 0));break;case"gap":g=new _Keyframe2["default"](e,"strokeGap",h,c,f,y,u,(void 0),(void 0));break;case"offset":g=new _Keyframe2["default"](e,"strokeOffset",h,c,f,y,u,(void 0),(void 0));break;case"width":g=new _Keyframe2["default"](e,"strokeWidth",h,c,f,y,u,(void 0),(void 0))}void 0!==g&&(g.easeType=l.type,r.addKeyframe(g))}}},morph:function(e,t,r,i){var a,n,o,s,l=this;for(n=t.length,a=0;a<n;++a){var u=t[a];s=u.keys.length;var h=function(){f=u.keys[o],c=f.start,d=f.duration,p=[f.x0,f.y0,f.x1,f.y1];var t={index:o,value:0,total:f.verticesValue.length,vertsValue:f.verticesValue,vertsTarget:f.verticesTarget,tanInValue:f.inTangentsValue,tanInTarget:f.inTangentsTarget,tanOutValue:f.outTangentsValue,tanOutTarget:f.outTangentsTarget};m=new _Keyframe2["default"](t,"value",1,d,c,p,(void 0),(void 0),function(i,a){for(var n={vertices:[],inTangents:[],outTangents:[]},o=0;o<t.total;++o){var s=o+1;if(closed)s%=t.total;else if(s>=t.total)break;n.vertices.push([_MathUtil2["default"].lerp(a,t.vertsValue[s][0],t.vertsTarget[s][0]),_MathUtil2["default"].lerp(a,t.vertsValue[s][1],t.vertsTarget[s][1])]),n.inTangents.push([_MathUtil2["default"].lerp(a,t.tanInValue[s][0],t.tanInTarget[s][0]),_MathUtil2["default"].lerp(a,t.tanInValue[s][1],t.tanInTarget[s][1])]),n.outTangents.push([_MathUtil2["default"].lerp(a,t.tanOutValue[s][0],t.tanOutTarget[s][0]),_MathUtil2["default"].lerp(a,t.tanOutValue[s][1],t.tanOutTarget[s][1])])}var u=l.getMaxBorder(r),h=l.bezierToPath(n,void 0,u,u);e.setAttribute("d",h),l.determineBounds(e,n,u)}),m.easeType=f.type,i.addKeyframe(m)};for(o=0;o<s;++o){var f,c,d,p,m;h()}}},create:function(){var e=window.document.createElementNS("http://www.w3.org/2000/svg","svg");return e},addPath:function(e,t,r,i){var a=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(a)},applyMasks:function(e,t){if(t.length>0){var r="url(#"+t.join(" ")+")";e.setAttribute("clip-path",r)}},createMasks:function(e,t){var r=[];if(void 0!==t.masks){var i,a=t.masks.length;for(i=0;i<a;++i){var n=t.masks[i],o=this.bezierToPath(n,!0),s=this.getDefs(e);void 0===s&&(s=document.createElementNS("http://www.w3.org/2000/svg","defs"),e.appendChild(s));var l=document.createElementNS("http://www.w3.org/2000/svg","clipPath");l.id=n.name,s.appendChild(l),r.push(n.name);var u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",o),l.appendChild(u)}}return r},circle:function(e,t,r,i){var a=document.createElementNS("http://www.w3.org/2000/svg","circle"),n=this.getMaxBorder(t);if(this.setup(a,t),a.x=e.x+n,a.y=e.y+n,a.radius=e.width,t.timeline.length>0&&void 0!==i&&this.animate(a,t.timeline,i),void 0!==r){var o=e.x+e.width+2*n,s=e.y+e.height+2*n;o>r.width&&(r.width=o),s>r.height&&(r.height=s)}return a},ellipse:function(e,t,r,i){var a=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),n=this.getMaxBorder(t);if(this.setup(a,t),a.x=e.width/2+e.x+n,a.y=e.height/2+e.y+n,a.width=e.width,a.height=e.height,t.timeline.length>0&&void 0!==i&&this.animate(a,t.timeline,i),void 0!==r){var o=e.x+e.width+2*n,s=e.y+e.height+2*n;o>r.width&&(r.width=o),s>r.height&&(r.height=s)}return a},rectangle:function(e,t,r,i){var a=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=this.getMaxBorder(t);if(this.setup(a,t),a.x=e.x+n/2,a.y=e.y+n/2,a.width=e.width,a.height=e.height,a.roundness=e.roundness,t.timeline.length>0&&void 0!==i&&this.animate(a,t.timeline,i),void 0!==r){var o=e.x+e.width+n,s=e.y+e.height+n;o>r.width&&(r.width=o),s>r.height&&(r.height=s)}return a},determineBounds:function(e,t,r){var i,a=1e8,n=1e8,o=0,s=0,l=t.vertices,u=t.inTangents,h=t.outTangents,f=l.length;for(i=0;i<f;++i){var c=l[i][0]+h[i][0],d=l[i][1]+h[i][1];c<a&&(a=c),d<n&&(n=d)}for(i=0;i<f;++i){var p=l[i][0]+u[i][0]-a,m=l[i][1]+u[i][1]-n;p>o&&(o=p),m>s&&(s=m)}e.x=a+r,e.y=n+r,e.width=o,e.height=s},shape:function(e,t,r,i){var a=document.createElementNS("http://www.w3.org/2000/svg","path"),n=this.getMaxBorder(t),o=this.bezierToPath(e,void 0,n,n);if(a.setAttribute("d",o),this.setup(a,t),this.determineBounds(a,e,n),void 0!==i&&(t.timeline.length>0?this.animate(a,t.timeline,i):e.timeline.length>0&&this.morph(a,e.timeline,t,i)),void 0!==r){var s=a.x+a.width+2*n,l=a.y+a.height+2*n;s>r.width&&(r.width=s),l>r.height&&(r.height=l)}return a},setup:function(e,t){this.extend(e),void 0!==t.fill&&(e.fill=t.fill,void 0!==t.fillAlpha&&(e.fillAlpha=t.fillAlpha)),void 0!==t.stroke&&(e.stroke=t.stroke,e.strokeAlpha=t.strokeAlpha,e.strokeCap=t.strokeCap,e.strokeCorner=t.strokeCorner,e.strokeWidth=t.strokeWidth,void 0!==t.strokeDashes&&(e.strokeDash=t.strokeDashes.dash,e.strokeGap=t.strokeDashes.gap,e.strokeOffset=t.strokeDashes.offset))},extend:function(e){var t={fill:"none",fillR:-1,fillG:-1,fillB:-1,fillA:1,stroke:"none",strokeCap:"butt",strokeCorner:"miter",strokeDash:{dash:0,gap:0,offset:0},strokeR:-1,strokeG:-1,strokeB:-1,strokeA:1,strokeWidth:1};if(Object.defineProperty(e,"fill",{get:function(){return t.fill},set:function(e){t.fill=e;var r=_DOMUtil2["default"].cssToHex(t.fill);t.fillR=r[0],t.fillG=r[1],t.fillB=r[2],this.setAttribute("fill",e)}}),Object.defineProperty(e,"fillAlpha",{get:function(){return t.fillAlpha},set:function(e){t.fillAlpha=e,this.setAttribute("fill-opacity",e)}}),Object.defineProperty(e,"stroke",{get:function(){return t.stroke},set:function(e){t.stroke=e,this.setAttribute("stroke",e)}}),Object.defineProperty(e,"strokeCap",{get:function(){return t.strokeCap},set:function(e){t.strokeCap=e,this.setAttribute("stroke-linecap",e)}}),Object.defineProperty(e,"strokeCorner",{get:function(){return t.strokeCorner},set:function(e){t.strokeCorner=e,this.setAttribute("stroke-linejoin",e)}}),Object.defineProperty(e,"strokeDash",{get:function(){return t.strokeDash.dash},set:function(e){t.strokeDash.dash=e,this.setAttribute("stroke-dasharray",t.strokeDash.dash.toString()+", "+t.strokeDash.gap.toString())}}),Object.defineProperty(e,"strokeGap",{get:function(){return t.strokeDash.gap},set:function(e){t.strokeDash.gap=e,this.setAttribute("stroke-dasharray",t.strokeDash.dash.toString()+", "+t.strokeDash.gap.toString())}}),Object.defineProperty(e,"strokeOffset",{get:function(){return t.strokeDash.offset},set:function(e){t.strokeDash.offset=e,this.setAttribute("stroke-dashoffset",t.strokeDash.offset)}}),Object.defineProperty(e,"strokeAlpha",{get:function(){return t.strokeAlpha},set:function(e){t.strokeAlpha=e,this.setAttribute("stroke-opacity",e)}}),Object.defineProperty(e,"strokeWidth",{get:function(){return t.strokeWidth},set:function(e){t.strokeWidth=e,this.setAttribute("stroke-width",e)}}),e.getAttribute("fill")&&(e.fill=e.getAttribute("fill")),e.getAttribute("fill-opacity")&&(e.fillAlpha=e.getAttribute("fill-opacity")),e.getAttribute("stroke")&&(t.stroke=e.getAttribute("stroke")),e.getAttribute("stroke-linecap")&&(e.strokeCap=e.getAttribute("stroke-linecap")),e.getAttribute("stroke-linejoin")&&(e.strokeCorner=e.getAttribute("stroke-linejoin")),e.getAttribute("stroke-opacity")&&(e.strokeAlpha=Number(e.getAttribute("stroke-opacity"))),e.getAttribute("stroke-width")&&(e.strokeWidth=Number(e.getAttribute("stroke-width"))),e.getAttribute("stroke-dashoffset")&&(e.strokeOffset=Number(e.getAttribute("stroke-dashoffset"))),e.getAttribute("stroke-dasharray")){var r=e.getAttribute("stroke-dasharray").split(", ");e.strokeDash=Number(r[0]),e.strokeGap=Number(r[1])}var i={x:0,y:0,width:0,height:0,roundness:0};switch(e.tagName){case"rect":this.extendRect(e,i);break;case"circle":this.extendCircle(e,i);break;case"ellipse":this.extendEllipse(e,i);break;case"path":this.extendPath(e);break;case"polygon":break;case"polystar":}return e},extendRect:function(e,t){e.getAttribute("x")&&(t.x=Number(e.getAttribute("x"))),e.getAttribute("y")&&(t.y=Number(e.getAttribute("y"))),e.getAttribute("width")&&(t.width=Number(e.getAttribute("width"))),e.getAttribute("height")&&(t.height=Number(e.getAttribute("height"))),e.getAttribute("rx")&&(t.roundness=Number(e.getAttribute("rx"))),Object.defineProperty(e,"x",{get:function(){return t.x},set:function(e){t.x=e,this.setAttribute("x",e)}}),Object.defineProperty(e,"y",{get:function(){return t.x},set:function(e){t.y=e,this.setAttribute("y",e)}}),Object.defineProperty(e,"width",{get:function(){
return t.width},set:function(e){t.width=e,this.setAttribute("width",e)}}),Object.defineProperty(e,"height",{get:function(){return t.height},set:function(e){t.height=e,this.setAttribute("height",e)}}),Object.defineProperty(e,"roundness",{get:function(){return t.roundness},set:function(e){t.roundness=e,this.setAttribute("rx",e),this.setAttribute("ry",e)}})},extendCircle:function(e,t){e.getAttribute("cx")&&(t.x=Number(e.getAttribute("x"))),e.getAttribute("cy")&&(t.y=Number(e.getAttribute("y"))),e.getAttribute("r")&&(t.width=t.height=Number(e.getAttribute("r"))),Object.defineProperty(e,"x",{get:function(){return t.x},set:function(e){t.x=e,this.setAttribute("cx",e)}}),Object.defineProperty(e,"y",{get:function(){return t.y},set:function(e){t.y=e,this.setAttribute("cy",e)}}),Object.defineProperty(e,"radius",{get:function(){return t.width},set:function(e){t.width=e,t.height=e,this.setAttribute("r",e)}})},extendEllipse:function(e,t){e.getAttribute("cx")&&(t.x=Number(e.getAttribute("x"))),e.getAttribute("cy")&&(t.y=Number(e.getAttribute("y"))),e.getAttribute("rx")&&(t.width=Number(e.getAttribute("rx"))),e.getAttribute("ry")&&(t.height=Number(e.getAttribute("ry"))),Object.defineProperty(e,"x",{get:function(){return t.x},set:function(e){t.x=e,this.setAttribute("cx",e)}}),Object.defineProperty(e,"y",{get:function(){return t.y},set:function(e){t.y=e,this.setAttribute("cy",e)}}),Object.defineProperty(e,"width",{get:function(){return t.width},set:function(e){t.width=e,this.setAttribute("rx",e/2)}}),Object.defineProperty(e,"height",{get:function(){return t.height},set:function(e){t.height=e,this.setAttribute("ry",e/2)}})},extendPath:function(e){e.straightPath=!0,void 0!==e.getAttribute("d")&&(e.straightPath=!e.getAttribute("d").match(/[C|c|S|s]/g)),e.points=this.pathToPoints(e),e.originals=e.points.slice(),e.segments=_MathUtil2["default"].bezierPathDistance(e.points[0]),e._startPercent=0,e._endPercent=1,e._offsetPercent=0;var t=(Date.now(),this);Object.defineProperty(e,"firstPath",{set:function(e){this.points[0]=e},get:function(){return this.points||(void 0!==this.getAttribute("d")?this.points=t.pathToPoints(this.getAttribute("d"),this.straightPath):this.points=[[]]),this.points[0]}}),Object.defineProperty(e,"startPercent",{get:function(){return this._startPercent},set:function(e){this._startPercent=e,this.updatePath()}}),Object.defineProperty(e,"endPercent",{get:function(){return this._endPercent},set:function(e){this._endPercent=e,this.updatePath()}}),Object.defineProperty(e,"offsetPercent",{get:function(){return this._offsetPercent},set:function(e){this._offsetPercent=e,this.updatePath()}}),e.pointAt=function(t){return _MathUtil2["default"].getPointInPath(e.points[0],e.segments,t)},e.updatePathBetween=function(e,t){this.refPath=this.refPath||this.firstPath,this.firstPath=this.refPath.slice(),this.segments||(this.segments=_MathUtil2["default"].bezierPathDistance(this.points[0]));var r=3,i=this.segments.slice(),a=new Object,n=null,o=_MathUtil2["default"].roundTo(e,r),s=_MathUtil2["default"].roundTo(t,r);if(o>s){var l=_MathUtil2["default"].lerpArray(.5,o,1+s);l=_MathUtil2["default"].roundTo(l-Math.floor(l),r),l>=e&&l<=t&&(n=l)}return(this._startPercent>0||this._endPercent<1)&&(this.firstPath=_MathUtil2["default"].getPathBetween(e,t,this.firstPath,i,a,n)),[this.firstPath]},e.updatePath=function(){var e=this.originals,r=this._offsetPercent,i=this._startPercent+r,a=this._endPercent+r;if((i>1||i<0)&&(i%=1),(a>1||a<0)&&(a%=1),i===a)return void this.setAttribute("d","");if(0===a&&0!==this._endPercent&&(a=1),i>0||a<1)if(i>a){e=this.updatePathBetween(i,1);var n=t.arrayToSVGPath(e,this.straightPath);e=this.updatePathBetween(0,a);var o=t.arrayToSVGPath(e,this.straightPath);this.setAttribute("d",n+o)}else{e=this.updatePathBetween(i,a);var n=t.arrayToSVGPath(e,this.straightPath);this.setAttribute("d",n)}}},getMaxBorder:function(e){var t=void 0!==e.strokeWidth?e.strokeWidth/2:0;if(e.timeline.length>0){var r,i=e.timeline.length;for(r=0;r<i;++r){var a=e.timeline[r];if("width"===a.name){var n,o=a.keys.length;for(n=0;n<o;++n){var s=a.keys[n];s.target>t?t=s.target:s.value>t&&(t=s.value)}return t}}}return t},addCurveForLine:function(e,t,r,i){e.push(_MathUtil2["default"].lerpArray(.01,t,r)),e.push(_MathUtil2["default"].lerpArray(.99,t,r)),e.push(r)},addPointToArray:function(e,t,r,i){var a=[0,0];switch(e.length>0&&(a=e[e.length-1]),r){case"M":e.push([t[0],t[1]]);break;case"c":this.pushNumbersForCurve(e,t,a);break;case"C":this.pushNumbersForCurve(e,t,[0,0]);break;case"h":this.addCurveForLine(e,a,[a[0]+t[0],a[1]],i);break;case"H":this.addCurveForLine(e,a,[t[0],a[1]],i);break;case"v":this.addCurveForLine(e,a,[a[0],a[1]+t[0]],i);break;case"V":this.addCurveForLine(e,a,[a[0],t[0]],i);break;case"l":this.addCurveForLine(e,a,_MathUtil2["default"].add(a,t),i);break;case"L":this.addCurveForLine(e,a,t,i);break;case"S":var n=e[e.length-2],o=_MathUtil2["default"].subArray(a,n),s=_MathUtil2["default"].addArray(a,o);e.push(s),e.push([t[0],t[1]]),e.push([t[2],t[3]]);break;case"s":var n=e[e.length-2],o=_MathUtil2["default"].subArray(a,n),s=_MathUtil2["default"].addArray(a,o);e.push(s),e.push([a[0]+t[0],a[1]+t[1]]),e.push([a[0]+t[2],a[1]+t[3]]);break;default:console.log("ORDER UNKNOWN :",r)}},arrayToSVGString:function(e,t){var r="M"+Math.floor(10*e[0][0])/10+","+(Math.floor(10*e[0][1])/10).toString();if(t)for(var i=1,a=e.length;i<a;i++)r+="L"+Math.floor(10*e[i][0])/10,e[i][1]>=0&&(r+=","),r+=(Math.floor(10*e[i][1])/10).toString();else for(var i=1,a=e.length;i<a;i+=3){r+="C"+Math.floor(10*e[i][0])/10+","+Math.floor(10*e[i][1])/10;for(var n=i+1;n<i+3;n++)r+=","+(Math.floor(10*e[n][0])/10).toString()+","+(Math.floor(10*e[n][1])/10).toString()}return r},arrayToSVGPath:function(e,t){for(var r=[],i=0,a=e.length;i<a;i++)r+=this.arrayToSVGString(e[i],t);return r},arrayToSVGPoints:function(e){for(var t="",r=0,i=e.length;r<i;r++)t+=e[r][0].toString()+","+e[r][1].toString()+" ";return t},bezierToPath:function(e,t,r,i){var a=e.vertices,n=e.inTangents,o=e.outTangents,s=void 0!==r?r:0,l=void 0!==i?i:0,u="M";u+=_MathUtil2["default"].roundTo(a[0][0]+s,1).toString()+","+_MathUtil2["default"].roundTo(a[0][1]+l,1).toString();var h,f,c,d,p,m,v,y,g,_,b,w,k,C,x,P=a.length-1,T=P-1;for(h=0;h<P;++h)f=h+1,c=a[h],d=n[h],p=o[h],m=a[f],v=n[f],y=o[f],g=_MathUtil2["default"].roundTo(c[0]+p[0]+s,1),_=_MathUtil2["default"].roundTo(c[1]+p[1]+l,1),k=_MathUtil2["default"].roundTo(m[0]+s,1),C=_MathUtil2["default"].roundTo(m[1]+l,1),b=_MathUtil2["default"].roundTo(k+v[0],1),w=_MathUtil2["default"].roundTo(C+v[1],1),x=0===d[0]&&0===d[1]&&0===p[0]&&0===p[1],x=x||k===b&&C===w,x?(u+="L",u+=b.toString()+","+w.toString(),h<T&&(u+=",")):(u+="C",u+=g.toString()+","+_.toString()+",",u+=b.toString()+","+w.toString()+",",u+=k.toString()+","+C.toString());return e.closed!==!0&&t!==!0||(h=P,f=0,c=a[h],d=n[h],p=o[h],m=a[f],v=n[f],y=o[f],0===d[0]&&0===d[1]&&0===p[0]&&0===p[1]?(u+="L",u+=_MathUtil2["default"].roundTo(c[0]+s,1).toString()+","+_MathUtil2["default"].roundTo(c[1]+l,1).toString()+",",u+="Z"):(u+="C",u+=_MathUtil2["default"].roundTo(c[0]+p[0]+s,1).toString()+","+_MathUtil2["default"].roundTo(c[1]+p[1]+l,1).toString()+",",u+=_MathUtil2["default"].roundTo(m[0]+v[0]+s,1).toString()+","+_MathUtil2["default"].roundTo(m[1]+v[1]+l,1).toString()+",",u+=_MathUtil2["default"].roundTo(m[0]+s).toString()+","+_MathUtil2["default"].roundTo(m[1]+l).toString())),u},pathToPoints:function(e){var t=e.getAttribute("d"),r=void 0!==t&&!t.match(/[C|c|S|s]/g),i=t.match(/([a-z]|[A-Z])/g),a=t.match(/([^a-zA-Z]+)/g),n=[],o=[];n.push(o);for(var s=0,l=a.length;s<l;s++){var u=a[s],h=u.match(/\-?[0-9|\.]+/g);if(h){for(var f=0,c=h.length;f<c;f++)h[f]=parseFloat(h[f]);this.addPointToArray(o,h,i[s],r)}else o=[],n.push(o)}return n},pointsToArray:function(e){for(var t=e.match(/\-?[0-9|\.]+/g),r=[],i=0,a=t.length;i<a;i+=2)r.push([parseFloat(t[i]),parseFloat(t[i+1])]);return r},pushNumbersForCurve:function(e,t,r){for(var i=0,a=t.length;i<a;i+=2)e.push(_MathUtil2["default"].addArray(r,[t[i],t[i+1]]))},getDefs:function(e){var t,r=e.children.length;for(t=0;t<r;++t){var i=e.children[t];if("defs"===i.tagName)return i}}};exports["default"]=SVG,Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_CSSUtil=require("apollo-utils/CSSUtil"),_CSSUtil2=_interopRequireDefault(_CSSUtil),_SVGUtil=require("./SVGUtil"),_SVGUtil2=_interopRequireDefault(_SVGUtil),_Keyframe=require("../timeline/Keyframe"),_Keyframe2=_interopRequireDefault(_Keyframe),SVGItem=function(){function e(t,r){_classCallCheck(this,e),this.item=_SVGUtil2["default"].create(),_CSSUtil2["default"].extend(this.item),this.item.title=t.name;var i=_SVGUtil2["default"].createMasks(this.item,t),a=t.transform;void 0!==a&&e.transform(this.item,a,r);for(var n=t.content.length,o=0;o<n;++o){var s=t.content[o],l=void 0,u=void 0;if("shape"===s.type){var h=styleOptions(this.item,s.content,r),f=_SVGUtil2["default"].getMaxBorder(h);for(u=s.paths.length,l=0;l<u;++l){var c=s.paths[l],d=void 0;switch(c.type){case"rectangle":d=_SVGUtil2["default"].rectangle(c,h,this.item,r);break;case"ellipse":d=_SVGUtil2["default"].ellipse(c,h,this.item,r),this.item.x-=f/2,this.item.y-=f/2;break;case"polygon":break;case"polystar":break;case"shape":d=_SVGUtil2["default"].shape(c,h,this.item,r),this.item.x-=f/2,this.item.y-=f/2}void 0!==d?(this.item.x-=f/2,this.item.y-=f/2,_SVGUtil2["default"].applyMasks(d,i),this.item.appendChild(d)):console.log(l,"no shape")}for(u=s.content.length,l=0;l<u;++l){var p=s.content[l];"trim"===p.type&&applyTrimPath(this.item.children[0],p,r)}}else if("trim"===s.type)for(u=this.item.children.length,l=0;l<u;++l){var m=this.item.children[l];"path"===m.tagName&&applyTrimPath(m,s,r)}}}return _createClass(e,null,[{key:"transform",value:function(e,t,r){var i=t.anchor,a=t.position,n=t.rotation,o=t.scale,s=i[0]/e.width*100,l=i[1]/e.height*100;if(e.style.position="absolute",e.x=a[0],e.y=a[1],e.rotateX=n[0],e.rotateY=n[1],e.rotateZ=n[2],e.scaleX=o[0],e.scaleY=o[1],e.originX=s,e.originY=l,e.translateX=-i[0],e.translateY=-i[1],e.translateZ=a.length>2?a[2]:0,e.opacity=t.opacity,void 0!==t.timeline){var u=void 0,h=void 0,f=void 0,c=t.timeline.length;for(u=0;u<c;++u){var d=t.timeline[u];for(f=d.keys.length,h=0;h<f;++h){var p=d.keys[h],m=p.value,v=p.target,y=p.start,g=p.duration,_=p.x0,b=p.y0,w=p.x1,k=p.y1,C=[_,b,w,k],x=void 0;switch(d.name){case"opacity":x=new _Keyframe2["default"](e,"opacity",v,g,y,C,m);break;case"positionX":x=new _Keyframe2["default"](e,"x",v,g,y,C,m);break;case"positionY":x=new _Keyframe2["default"](e,"y",v,g,y,C,m);break;case"positionZ":x=new _Keyframe2["default"](e,"translateZ",v,g,y,C,m);break;case"rotationX":m*=-1,x=new _Keyframe2["default"](e,"rotateX",(-v),g,y,C,m);break;case"rotationY":m*=-1,x=new _Keyframe2["default"](e,"rotateY",(-v),g,y,C,m);break;case"rotationZ":x=new _Keyframe2["default"](e,"rotateZ",v,g,y,C,m);break;case"scaleX":x=new _Keyframe2["default"](e,"scaleX",v,g,y,C,m);break;case"scaleY":x=new _Keyframe2["default"](e,"scaleY",v,g,y,C,m);break;case"scaleZ":x=new _Keyframe2["default"](e,"scaleZ",v,g,y,C,m)}void 0!==x&&(x.easeType=p.type,r.addKeyframe(x))}}}}}]),e}();exports["default"]=SVGItem,module.exports=function(e){e.EffectComposer=function(t,r){if(this.renderer=t,void 0===r){var i={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBAFormat,stencilBuffer:!1},a=t.getSize();r=new e.WebGLRenderTarget(a.width,a.height,i)}this.renderTarget1=r,this.renderTarget2=r.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===e.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new e.ShaderPass(e.CopyShader)},Object.assign(e.EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e);var t=this.renderer.getSize();e.setSize(t.width,t.height)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(t){var r,i,a=!1,n=this.passes.length;for(i=0;i<n;i++)if(r=this.passes[i],r.enabled!==!1){if(r.render(this.renderer,this.writeBuffer,this.readBuffer,t,a),r.needsSwap){if(a){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}r instanceof e.MaskPass?a=!0:r instanceof e.ClearMaskPass&&(a=!1)}},reset:function(e){if(void 0===e){var t=this.renderer.getSize();e=this.renderTarget1.clone(),e.setSize(t.width,t.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this.renderTarget1.setSize(e,t),this.renderTarget2.setSize(e,t);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(e,t)}}),e.Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1},Object.assign(e.Pass.prototype,{setSize:function(e,t){},render:function(e,t,r,i,a){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),e.RenderPass=function(t,r,i,a,n){e.Pass.call(this),this.scene=t,this.camera=r,this.overrideMaterial=i,this.clearColor=a,this.clearAlpha=void 0!==n?n:1,this.oldClearColor=new e.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},e.RenderPass.prototype=Object.assign(Object.create(e.Pass.prototype),{constructor:e.RenderPass,render:function(e,t,r,i){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.render(this.scene,this.camera,r,this.clear),this.clearColor&&e.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}}),e.ShaderPass=function(t,r){e.Pass.call(this),this.textureID=void 0!==r?r:"tDiffuse",this.uniforms=e.UniformsUtils.clone(t.uniforms),this.material=new e.ShaderMaterial({defines:t.defines||{},uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.camera=new e.OrthographicCamera((-1),1,1,(-1),0,1),this.scene=new e.Scene,this.quad=new e.Mesh(new e.PlaneBufferGeometry(2,2),null),this.scene.add(this.quad)},e.ShaderPass.prototype=Object.assign(Object.create(e.Pass.prototype),{constructor:e.ShaderPass,render:function(e,t,r,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}}),e.MaskPass=function(t,r){e.Pass.call(this),this.scene=t,this.camera=r,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},e.MaskPass.prototype=Object.assign(Object.create(e.Pass.prototype),{constructor:e.MaskPass,render:function(e,t,r,i){var a=e.context;a.colorMask(!1,!1,!1,!1),a.depthMask(!1);var n,o;this.inverse?(n=0,o=1):(n=1,o=0),a.enable(a.STENCIL_TEST),a.stencilOp(a.REPLACE,a.REPLACE,a.REPLACE),a.stencilFunc(a.ALWAYS,n,4294967295),a.clearStencil(o),e.render(this.scene,this.camera,r,this.clear),e.render(this.scene,this.camera,t,this.clear),a.colorMask(!0,!0,!0,!0),a.depthMask(!0),a.stencilFunc(a.EQUAL,1,4294967295),a.stencilOp(a.KEEP,a.KEEP,a.KEEP)}}),e.ClearMaskPass=function(){e.Pass.call(this),this.enabled=!0},e.ClearMaskPass.prototype=Object.assign(Object.create(e.Pass.prototype),{constructor:e.ClearMaskPass,render:function(e,t,r,i){var a=e.context;a.disable(a.STENCIL_TEST)}}),e.SavePass=function(t){e.ShaderPass.call(this),void 0===e.CopyShader&&console.error("THREE.SavePass relies on THREE.CopyShader");var r=e.CopyShader;this.textureID="tDiffuse",this.uniforms=e.UniformsUtils.clone(r.uniforms),this.material=new e.ShaderMaterial({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.renderTarget=t,void 0===this.renderTarget&&(this.renderTargetParameters={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBFormat,stencilBuffer:!1},this.renderTarget=new e.WebGLRenderTarget(window.innerWidth,window.innerHeight,this.renderTargetParameters)),this.needsSwap=!1,this.camera=new e.OrthographicCamera((-1),1,1,(-1),0,1),this.scene=new e.Scene,this.quad=new e.Mesh(new e.PlaneBufferGeometry(2,2),null),this.scene.add(this.quad)},e.SavePass.prototype=Object.assign(Object.create(e.ShaderPass.prototype),{constructor:e.SavePass,render:function(e,t,r,i,a){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r),this.quad.material=this.material,e.render(this.scene,this.camera,this.renderTarget,this.clear)}}),e.BloomPass=function(t,r,i,a){e.Pass.call(this),t=void 0!==t?t:1,r=void 0!==r?r:25,i=void 0!==i?i:4,a=void 0!==a?a:256;var n={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBAFormat};this.renderTargetX=new e.WebGLRenderTarget(a,a,n),this.renderTargetY=new e.WebGLRenderTarget(a,a,n),void 0===e.CopyShader&&console.error("THREE.BloomPass relies on THREE.CopyShader");var o=e.CopyShader;this.copyUniforms=e.UniformsUtils.clone(o.uniforms),this.copyUniforms.opacity.value=t,this.materialCopy=new e.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:e.AdditiveBlending,transparent:!0}),void 0===e.ConvolutionShader&&console.error("THREE.BloomPass relies on THREE.ConvolutionShader");var s=e.ConvolutionShader;this.convolutionUniforms=e.UniformsUtils.clone(s.uniforms),this.convolutionUniforms.uImageIncrement.value=e.BloomPass.blurX,this.convolutionUniforms.cKernel.value=e.ConvolutionShader.buildKernel(i),this.materialConvolution=new e.ShaderMaterial({uniforms:this.convolutionUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,defines:{KERNEL_SIZE_FLOAT:r.toFixed(1),KERNEL_SIZE_INT:r.toFixed(0)}}),this.enabled=!0,this.needsSwap=!1,this.clear=!1,this.camera=new e.OrthographicCamera((-1),1,1,(-1),0,1),this.scene=new e.Scene,this.quad=new e.Mesh(new e.PlaneBufferGeometry(2,2),null),this.scene.add(this.quad)},e.BloomPass.prototype=Object.assign(Object.create(e.Pass.prototype),{constructor:e.BloomPass,render:function(t,r,i,a,n){n&&t.context.disable(t.context.STENCIL_TEST),this.quad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=i,this.convolutionUniforms.uImageIncrement.value=e.BloomPass.blurX,t.render(this.scene,this.camera,this.renderTargetX,!0),this.convolutionUniforms.tDiffuse.value=this.renderTargetX,this.convolutionUniforms.uImageIncrement.value=e.BloomPass.blurY,t.render(this.scene,this.camera,this.renderTargetY,!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY,n&&t.context.enable(t.context.STENCIL_TEST),t.render(this.scene,this.camera,i,this.clear)}}),e.BloomPass.blurX=new e.Vector2(.001953125,0),e.BloomPass.blurY=new e.Vector2(0,.001953125),e.BlendShader={uniforms:{tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},mixRatio:{type:"f",value:.5},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},e.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},e.ConvolutionShader={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{type:"t",value:null},uImageIncrement:{type:"v2",value:new e.Vector2(.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-(e*e)/(2*t*t))}var r,i,a,n,o=25,s=2*Math.ceil(3*e)+1;for(s>o&&(s=o),n=.5*(s-1),i=new Array(s),a=0,r=0;r<s;++r)i[r]=t(r-n,e),a+=i[r];for(r=0;r<s;++r)i[r]/=a;return i}}},module.exports=function(e){var t={fbos:[],post:[],addFBO:function(e,t){this.fbos.push({target:e,call:t})},addPost:function(e,t){this.post.push({target:e,call:t})},create:function(t,r,i){var a=window.devicePixelRatio,n=(void 0!==t?t:window.innerWidth)*a,o=(void 0!==r?r:window.innerHeight)*a,s=new e.WebGLRenderTarget(n,o,{minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:void 0!==i?i:e.RGBAFormat,depthBuffer:!1,stencilBuffer:!1});return s.texture.generateMipmaps=!1,s},update:function(){var e=void 0,t=this.fbos.length;for(e=0;e<t;++e){var r=this.fbos[e];r.target[r.call]()}this.fbos=[]},postRender:function(){var e=void 0,t=this.post.length;for(e=0;e<t;++e){var r=this.post[e];r.target[r.call]()}this.post=[]}};return t};var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_MathUtil=require("apollo-utils/MathUtil"),_MathUtil2=_interopRequireDefault(_MathUtil),_Keyframe=require("../timeline/Keyframe"),_Keyframe2=_interopRequireDefault(_Keyframe),_Layer2=require("../timeline/Layer"),_Layer3=_interopRequireDefault(_Layer2);module.exports=function(e){var t=function(t){function r(t,i){_classCallCheck(this,r);var a=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t));return a.item=new e.Object3D,a.mesh=void 0,a}return _inherits(r,t),_createClass(r,null,[{key:"animate",value:function(e,t,r,i,a){var n=void 0!==a?window.devicePixelRatio:1,o=void 0,s=i.keys.length;for(o=0;o<s;++o){var l=i.keys[o],u=l.value,h=l.target,f=l.start,c=l.duration,d=[l.x0,l.y0,l.x1,l.y1],p=new _Keyframe2["default"](e,t,h*n,c,f,d,(void 0),(void 0),u*n);p.easeType=l.type,r.addKeyframe(p)}}},{key:"transform",value:function(e,t,r,i){var a=window.devicePixelRatio,n=r,o=n.anchor.length>2?n.anchor:[n.anchor[0],n.anchor[1],0],s=n.position.length>2?n.position:[n.position[0],n.position[1],0],l=n.rotation.length>2?n.rotation:[n.rotation[0],n.rotation[1],0],u=n.scale.length>2?n.scale:[n.scale[0],n.scale[1],1];if(e.position.set(s[0]*a,-s[1]*a,s[2]*a),e.scale.set(u[0],u[1],u[2]),e.rotation.set(_MathUtil2["default"].toRad(l[0]),_MathUtil2["default"].toRad(l[1]),-_MathUtil2["default"].toRad(l[2])),void 0!==t&&(t.position.set(-o[0]*a,o[1]*a,o[2]*a),void 0!==t.material&&(t.material.opacity=n.opacity)),void 0!==n.timeline){var h=void 0,f=void 0,c=void 0,d=void 0;for(c=n.timeline.length,h=0;h<c;++h){var p=n.timeline[h];for(d=p.keys.length,f=0;f<d;++f){var m=p.keys[f],v=m.value,y=m.target,g=m.start,_=m.duration,b=m.x0,w=m.y0,k=m.x1,C=m.y1,x=[b,w,k,C],P=void 0;switch(p.name){case"opacity":void 0!==t&&void 0!==t.material&&(P=new _Keyframe2["default"](t.material,"opacity",y,_,g,x,(void 0),(void 0),v));break;case"anchorX":void 0!==t&&(P=new _Keyframe2["default"](t.position,"x",-y*a,_,g,x,(void 0),(void 0),-v*a));break;case"anchorY":void 0!==t&&(P=new _Keyframe2["default"](t.position,"y",y*a,_,g,x,(void 0),(void 0),v*a));break;case"positionX":P=new _Keyframe2["default"](e.position,"x",y*a,_,g,x,(void 0),(void 0),v*a);break;case"positionY":P=new _Keyframe2["default"](e.position,"y",-y*a,_,g,x,(void 0),(void 0),-v*a);break;case"positionZ":P=new _Keyframe2["default"](e.position,"z",y*a,_,g,x,(void 0),(void 0),v*a);break;case"rotationX":P=new _Keyframe2["default"](e.rotation,"x",_MathUtil2["default"].toRad(y),_,g,x,(void 0),(void 0),_MathUtil2["default"].toRad(v));break;case"rotationY":P=new _Keyframe2["default"](e.rotation,"y",(-_MathUtil2["default"].toRad(y)),_,g,x,(void 0),(void 0),_MathUtil2["default"].toRad(-v));break;case"rotationZ":P=new _Keyframe2["default"](e.rotation,"z",(-_MathUtil2["default"].toRad(y)),_,g,x,(void 0),(void 0),_MathUtil2["default"].toRad(-v));break;case"scaleX":P=new _Keyframe2["default"](e.scale,"x",y,_,g,x,(void 0),(void 0),v);break;case"scaleY":P=new _Keyframe2["default"](e.scale,"y",y,_,g,x,(void 0),(void 0),v);break;case"scaleZ":P=new _Keyframe2["default"](e.scale,"z",y,_,g,x,(void 0),(void 0),v)}void 0!==P&&(P.easeType=m.type,i.addKeyframe(P))}}}}},{key:"morph",value:function(e,t,r,i){}}]),r}(_Layer3["default"]);return t};var _Config=require("../timeline/Config"),_Config2=_interopRequireDefault(_Config),_THREELayer2=require("./THREELayer"),_THREELayer3=_interopRequireDefault(_THREELayer2);module.exports=function(e){var t=function(t){function r(t,i){_classCallCheck(this,r);var a=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,i)),n=t.content.source,o=_Config2["default"].fileID(n),s=_Config2["default"].images[o],l=_Config2["default"].textures[o],u=n.search(".png")>-1,h=new e.PlaneGeometry(s.width,s.height);h.computeBoundingBox();var f=h.boundingBox,c=(f.max.x-f.min.x)/2,d=(f.max.y-f.min.y)/2,p=0;h.applyMatrix((new e.Matrix4).makeTranslation(c,-d,-p));var m=new e.MeshBasicMaterial({map:l,transparent:u,side:e.DoubleSide,depthTest:!1});return a.mesh=new e.Mesh(h,m),a.item.add(a.mesh),_THREELayer3["default"].transform(a.item,a.mesh,t.transform,i),a}return _inherits(r,t),r}(_THREELayer3["default"]);return t};var _THREELayer2=require("./THREELayer"),_THREELayer3=_interopRequireDefault(_THREELayer2),StrokeVertex="\n    uniform float thickness;,\n    attribute float lineMiter;,\n    attribute vec2 lineNormal;,\n    attribute vec2 lineDistance;, // x = pos, y = total length\n    varying vec2 lineU;,\n\n    void main() {,\n        lineU = lineDistance;,\n        vec3 pointPos = position.xyz + vec3(lineNormal * thickness/2.0 * lineMiter, 0.0);,\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( pointPos, 1.0 );,\n    }\n",StrokeFragment="\n    varying vec2 lineU;,\n\n    uniform vec3 diffuse;,\n    uniform float opacity;,\n    uniform vec3 dash;, // x = dash,  y = gap, z = offset\n    uniform vec3 trim;, // x = start, y = end, z = offset\n\n    void main() {,\n        float opacityMod = 1.0;,\n        \n        // Dash\n        if(dash.x > 0.0 && dash.y > 0.0) {,\n            float dashEnd = dash.x + dash.y;,\n            float lineUMod = mod(lineU.x + dash.z, dashEnd);,\n            opacityMod = 1.0 - smoothstep(dash.x, dash.x + 0.01, lineUMod);,\n        },\n        \n        // Trim\n        if(trim.x > 0.0 || trim.y < 1.0) {,\n            float a = mod(trim.x + trim.z, 1.0);,\n            float b = mod(trim.y + trim.z, 1.0);,\n            float per = lineU.x / lineU.y;,\n            if(a < b) {,\n                if(per < a || per > b) {,\n                    opacityMod = 0.0;,\n                },\n            } else if(a > b) {,\n                if(per < a && per > b) {,\n                    opacityMod = 0.0;,\n                },\n            },\n        },\n        \n        if(opacityMod == 0.0) {,\n            discard;,\n        },\n        gl_FragColor = vec4(diffuse, opacity * opacityMod);,\n    }\n";module.exports=function(e){function t(t){return new e.ShaderMaterial({uniforms:{thickness:{type:"f",value:void 0!==t.thickness?t.thickness:4},opacity:{type:"f",value:void 0!==t.opacity?t.opacity:1},diffuse:{type:"c",value:new e.Color(void 0!==t.diffuse?t.diffuse:16777215)},dash:{type:"f",value:void 0!==t.dash?t.dash:new e.Vector3(0,10,0)},trim:{type:"f",value:void 0!==t.trim?t.trim:new e.Vector3(0,1,0)}},vertexShader:StrokeVertex,fragmentShader:StrokeFragment,side:void 0!==t.side?t.side:e.DoubleSide,transparent:void 0===t.transparent||t.transparent})}var r=require("three-line-2d")(e),i=function(i){function a(i,n,o,s){function l(i){var a=void 0,o=i.length,s=void 0,u=void 0,c=void 0,d=void 0;for(a=0;a<o;++a){var p=i[a],m=void 0!==p.paths&&p.paths.length>0;if(m){var v=void 0,y=void 0,g=void 0,_=void 0,b=void 0,w=void 0,k=void 0,C=void 0,x=void 0,P=!0,T={opacity:1,anchor:[0,0,0],position:[0,0,0],rotation:[0,0,0],scale:[1,1,1],timeline:[]};for(c=p.content.length,d=organizeList(p.content),u=0;u<c;++u){var M=d[u];switch(M.type){case"fill":_={alpha:M.value.opacity,color:M.value.color};break;case"stroke":b={alpha:M.value.opacity,color:M.value.color,width:M.value.width*h,dashes:M.value.dashes};break;case"transform":T=M;break;case"trim":C=M;break;case"repeater":x=M}}if(void 0!==b){if(w=new e.Color(b.color[0],b.color[1],b.color[2]),s=new t({diffuse:w.getHex(),opacity:b.alpha,thickness:b.width}),void 0!==b.dashes&&(s.uniforms.dash.value.x=b.dashes.dash*h,s.uniforms.dash.value.y=b.dashes.gap*h,s.uniforms.dash.value.z=b.dashes.offset*h,void 0!==b.dashes.timeline))for(c=b.dashes.timeline.length,u=0;u<c;++u)switch(b.dashes.timeline[u].name){case"dash":_THREELayer3["default"].animate(s.uniforms.dash.value,"x",n,b.dashes.timeline[u],!0);break;case"gap":_THREELayer3["default"].animate(s.uniforms.dash.value,"y",n,b.dashes.timeline[u],!0);break;case"offset":_THREELayer3["default"].animate(s.uniforms.dash.value,"z",n,b.dashes.timeline[u],!0)}if(void 0!==C)for(s.uniforms.trim.value.x=C.value.start,s.uniforms.trim.value.y=C.value.end,s.uniforms.trim.value.z=C.value.offset,c=C.timeline.length,u=0;u<c;++u)switch(C.timeline[u].name){case"start":_THREELayer3["default"].animate(s.uniforms.trim.value,"x",n,C.timeline[u]);break;case"end":_THREELayer3["default"].animate(s.uniforms.trim.value,"y",n,C.timeline[u]);break;case"offset":_THREELayer3["default"].animate(s.uniforms.trim.value,"z",n,C.timeline[u])}}else void 0!==_&&(w=new e.Color(_.color[0],_.color[1],_.color[2]),s=new e.MeshBasicMaterial({color:w,opacity:_.alpha,side:e.DoubleSide,transparent:!0,depthTest:!1}));for(g=new e.Shape,c=p.paths.length,u=0;u<c;++u){var S=void 0,E=void 0,O=void 0,R=void 0,A=void 0,U=void 0,L=void 0,j=void 0,D=void 0,I=p.paths[u];switch(P=!0,I.type){case"ellipse":E=I.x*h,O=I.y*h,R=I.width/2*h,A=I.height/2*h,g.ellipse(E,O,R,A,0,MathU.TWO_PI,!0,Math.PI/2);break;case"rectangle":E=(I.x-I.width/2)*h,O=(I.y-I.height/2)*h,R=I.width*h,A=I.height*h,g.moveTo(E,O),g.lineTo(E+R,O),g.lineTo(E+R,O+A),g.lineTo(E,O+A);break;case"polygon":for(j=I.points,R=I.radius*h,S=MathU.HALF_PI,g.moveTo(Math.cos(S)*R,Math.sin(S)*R),U=1;U<I.points+1;++U)S=U/j*MathU.TWO_PI+MathU.HALF_PI,g.lineTo(Math.cos(S)*R,Math.sin(S)*R);break;case"polystar":for(j=2*I.points,R=I.outRadius*h,A=I.inRadius*h,S=MathU.toRad(I.rotation)+MathU.HALF_PI,g.moveTo(Math.cos(S)*R,Math.sin(S)*R),S=1/j*MathU.TWO_PI+MathU.toRad(I.rotation)+MathU.HALF_PI,g.lineTo(Math.cos(S)*A,Math.sin(S)*A),U=1;U<I.points;++U)S=2*U/j*MathU.TWO_PI+MathU.toRad(I.rotation)+MathU.HALF_PI,g.lineTo(Math.cos(S)*R,Math.sin(S)*R),S=(2*U+1)/j*MathU.TWO_PI+MathU.toRad(I.rotation)+MathU.HALF_PI,g.lineTo(Math.cos(S)*A,Math.sin(S)*A);break;case"shape":for(j=I.vertices.length,D=!1,P=I.closed,g.moveTo(I.vertices[0][0]*h,I.vertices[0][1]*-h),L=0;L<j;++L)if(0!==I.inTangents[L][0]||0!==I.inTangents[L][1]||0!==I.outTangents[L][0]||0!==I.outTangents[L][1]){
D=!0;break}if(D)for(L=0;L<j;++L){if(U=L+1,I.closed)U%=j;else if(U>=j)break;g.bezierCurveTo((I.vertices[L][0]+I.outTangents[L][0])*h,(I.vertices[L][1]+I.outTangents[L][1])*-h,(I.vertices[U][0]+I.inTangents[U][0])*h,(I.vertices[U][1]+I.inTangents[U][1])*-h,I.vertices[U][0]*h,I.vertices[U][1]*-h)}else for(L=0;L<j;++L){if(U=L+1,I.closed)U%=j;else if(U>=j)break;g.lineTo(I.vertices[U][0]*h,I.vertices[U][1]*-h)}_THREELayer3["default"].morph(g,I,n,I.closed)}}if(k=new e.Object3D,f.add(k),void 0!==b){var K=g.createPointsGeometry(36),q=createPath(K,!1);v=r(q,{closed:P,distances:void 0!==b.dashes||void 0!==C})}else v=new e.ShapeGeometry(g);y=new e.Mesh(v,s),_THREELayer3["default"].transform(k,y,T,n),k.add(y)}else{var B=new e.Object3D;B.name=p.name,f.add(B),f=B,l(p.content)}}}_classCallCheck(this,a);var u=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,i,n));u.mesh=new e.Object3D,u.item.add(u.mesh);var h=window.devicePixelRatio,f=u.mesh;return l(i.content),_THREELayer3["default"].transform(u.item,u.mesh,i.transform,n),u}return _inherits(a,i),a}(_THREELayer3["default"]);return i};var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_threeText2d=require("three-text2d"),_threeText2d2=_interopRequireDefault(_threeText2d),_THREELayer2=require("./THREELayer"),_THREELayer3=_interopRequireDefault(_THREELayer2);module.exports=function(e){var t=function(t){function r(t,i){_classCallCheck(this,r);var a=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,i));a.mesh=new e.Object3D,a.item.add(a.mesh);var n=t.content.font,o=t.content.fontSize*window.devicePixelRatio,s=Math.round(.33*o),l=getHex(t.content.fillColor[0],t.content.fillColor[1],t.content.fillColor[2]),u=new e.Color(l);return a.txtSprite=new _threeText2d2["default"].SpriteText2D(t.content.text,{align:_threeText2d2["default"].textAlign.bottomLeft,font:o.toString()+"px "+n,fillStyle:u.getStyle(),antialias:!0}),a.txtSprite.position.y=s,a.mesh.add(a.txtSprite),_THREELayer3["default"].transform(a.item,a.mesh,t.transform,i),a}return _inherits(r,t),_createClass(r,[{key:"text",get:function(){return this.txtSprite.text},set:function(e){this.txtSprite.text=e}}]),r}(_THREELayer3["default"]);return t};var _Config=require("../timeline/Config"),_Config2=_interopRequireDefault(_Config),_THREELayer2=require("./THREELayer"),_THREELayer3=_interopRequireDefault(_THREELayer2);module.exports=function(e){var t=function(t){function r(t,i){_classCallCheck(this,r);var a=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,i)),n=t.content.source;a.fileID=_Config2["default"].fileID(n),a.file=_Config2["default"].video[a.fileID],a.file.autoplay=!1,a.file.pause();var o=new e.VideoTexture(a.file),s=new e.PlaneGeometry(t.content.width,t.content.height);s.computeBoundingBox();var l=s.boundingBox,u=(l.max.x-l.min.x)/2,h=(l.max.y-l.min.y)/2,f=0;s.applyMatrix((new e.Matrix4).makeTranslation(u,-h,-f));var c=new e.MeshBasicMaterial({map:o,side:e.DoubleSide,depthTest:!1});return a.mesh=new e.Mesh(s,c),a.item.add(a.mesh),_THREELayer3["default"].transform(a.item,a.mesh,t.transform,i),a}return _inherits(r,t),r}(_THREELayer3["default"]);return t};